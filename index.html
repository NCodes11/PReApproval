<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home Loan Preapproval Calculator</title>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NJ33CDF4N2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-NJ33CDF4N2');
  </script>

  <!-- Tailwind & Dependencies -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    html { scroll-behavior: smooth; }
    #aboutSlide {
      transition: transform 0.3s ease-in-out;
      transform: translateX(100%);
    }
    #aboutSlide.active {
      transform: translateX(0%);
    }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-50 to-white min-h-screen">

  <!-- Navigation -->
  <nav class="bg-white shadow-md py-4 px-6 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-700">üè† Home Loan Preapproval</h1>
      <ul class="flex space-x-6 text-gray-600 font-medium">
        <li><a href="#calculator" class="hover:text-blue-600">Calculator</a></li>
        <li><a href="#result" class="hover:text-blue-600">Results</a></li>
        <li><button onclick="toggleAbout()" class="hover:text-blue-600">About</button></li>
      </ul>
    </div>
  </nav>

  <!-- Calculator -->
  <main class="flex justify-center px-4 mt-10" id="calculator">
    <div class="w-full max-w-3xl p-8 bg-white rounded-2xl shadow-xl">
      <h2 class="text-3xl font-bold text-center text-blue-800 mb-8">Home Loan Preapproval Calculator</h2>

      <form id="calculatorForm" class="space-y-6">
        <div>
          <label for="applicantType" class="block font-medium text-gray-700">Application Type</label>
          <select id="applicantType" class="w-full border border-gray-300 rounded px-3 py-2">
            <option value="single">Single</option>
            <option value="partner">Partner</option>
          </select>
        </div>

        <fieldset>
          <legend class="text-blue-700 font-semibold mb-2">Applicant 1</legend>
          <input type="number" id="income1" placeholder="Monthly Income" class="w-full border rounded px-3 py-2 mb-2" required>
          <input type="number" id="debts1" placeholder="Monthly Debts" class="w-full border rounded px-3 py-2 mb-2" required>
          <input type="number" id="creditScore1" placeholder="Credit Score" class="w-full border rounded px-3 py-2" required>
        </fieldset>

        <fieldset id="applicant2Section" class="hidden">
          <legend class="text-blue-700 font-semibold mt-4 mb-2">Applicant 2</legend>
          <input type="number" id="income2" placeholder="Monthly Income" class="w-full border rounded px-3 py-2 mb-2">
          <input type="number" id="debts2" placeholder="Monthly Debts" class="w-full border rounded px-3 py-2 mb-2">
          <input type="number" id="creditScore2" placeholder="Credit Score" class="w-full border rounded px-3 py-2">
        </fieldset>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label for="loanType" class="block font-medium text-gray-700">Loan Type</label>
            <select id="loanType" class="w-full border border-gray-300 rounded px-3 py-2">
              <option value="conventional">Conventional</option>
              <option value="fha">FHA</option>
              <option value="va">VA</option>
            </select>
          </div>
          <div>
            <label for="loanTerm" class="block font-medium text-gray-700">Loan Term (Years)</label>
            <select id="loanTerm" class="w-full border border-gray-300 rounded px-3 py-2">
              <option value="15">15</option>
              <option value="20">20</option>
              <option value="30" selected>30</option>
            </select>
          </div>
          <div>
            <label for="downPayment" class="block font-medium text-gray-700">Down Payment (%)</label>
            <input type="number" id="downPayment" value="10" class="w-full border border-gray-300 rounded px-3 py-2">
          </div>
        </div>

        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">üìä Calculate</button>
      </form>

      <div id="result" class="mt-6 text-center text-lg font-medium text-gray-800"></div>
      <canvas id="chart" class="mt-4 mx-auto w-60 h-60"></canvas>
    </div>
  </main>

  <!-- ABOUT Slide-out -->
  <aside id="aboutSlide" class="fixed top-0 right-0 w-full sm:w-1/2 lg:w-1/3 h-full bg-white shadow-lg p-6 overflow-y-auto z-50">
    <button onclick="toggleAbout()" class="text-red-500 font-bold mb-4">‚úñ Close</button>
    <h2 class="text-2xl font-bold text-blue-700 mb-4">üìò About This Tool</h2>
    <p class="text-gray-700 mb-4">
      This calculator estimates how much home you can afford based on your monthly income, debts, loan type, and down payment.
    </p>
    <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-2">üßÆ Formulas Used:</h3>
    <ul class="list-disc ml-6 text-gray-700 space-y-2">
      <li><strong>Total Income:</strong> income1 + income2</li>
      <li><strong>Total Debts:</strong> debts1 + debts2</li>
      <li><strong>Available for Mortgage:</strong> (Total Income √ó 0.43) ‚àí Total Debts</li>
      <li><strong>Loan Amount:</strong> (available √ó (1 - (1 + r)<sup>-n</sup>)) √∑ r</li>
      <li><strong>Home Price:</strong> Loan √∑ (1 ‚àí (Down Payment % √∑ 100))</li>
    </ul>
  </aside>

  <script>
    function toggleAbout() {
      document.getElementById('aboutSlide').classList.toggle('active');
    }

    document.getElementById('applicantType').addEventListener('change', function () {
      document.getElementById('applicant2Section').classList.toggle('hidden', this.value !== 'partner');
    });

    document.getElementById('calculatorForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const income1 = parseFloat(document.getElementById('income1').value) || 0;
      const debts1 = parseFloat(document.getElementById('debts1').value) || 0;
      const income2 = parseFloat(document.getElementById('income2').value) || 0;
      const debts2 = parseFloat(document.getElementById('debts2').value) || 0;
      const downPayment = parseFloat(document.getElementById('downPayment').value) || 10;
      const term = parseInt(document.getElementById('loanTerm').value) || 30;

      const totalIncome = income1 + income2;
      const totalDebts = debts1 + debts2;
      const maxDTI = 0.43;
      const available = (totalIncome * maxDTI) - totalDebts;

      const r = 0.07 / 12;
      const n = term * 12;
      const loan = available * (1 - Math.pow(1 + r, -n)) / r;
      const homePrice = loan / (1 - (downPayment / 100));

      document.getElementById('result').textContent =
        `üè° Estimated Home Price: $${homePrice.toFixed(0)} | Monthly Mortgage: $${available.toFixed(0)}`;

      const ctx = document.getElementById('chart').getContext('2d');
      if (window.chartRef) window.chartRef.destroy();
      window.chartRef = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Mortgage', 'Remaining'],
          datasets: [{
            data: [available, totalIncome - available],
            backgroundColor: ['#3b82f6', '#d1d5db']
          }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
      });
    });
  </script>
</body>
</html>
